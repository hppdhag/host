//LOADMORE PLUGIN
$.fn.spoiler=function(options){var val=[];var args=Array.prototype.slice.call(arguments,1);if(typeof options==='string'){this.each(function(){var instance=$.data(this,'spoiler');if(typeof instance!=='undefined'&&$.isFunction(instance[options])){var methodVal=instance[options].apply(instance,args);if(methodVal!==undefined&&methodVal!==instance)val.push(methodVal)}else return $.error('No such method "'+options+'" for Spoiler')})}else{this.each(function(){$.data(this,'spoiler',{});$.data(this,'spoiler',Spoiler(this,options))})}if(val.length===0)return this;else if(val.length===1)return val[0];else return val};function Spoiler(el,options){return new Spoiler.prototype.init(el,options)}$.Spoiler=Spoiler;$.Spoiler.NAME='spoiler';$.Spoiler.VERSION='1.0';$.Spoiler.opts={classButton:'btnloadMore',textButton:'Tải thêm',numberHide:10,elementHide:'.abcd',delay:true,delaySpeed:500,textLoading:'Đang tải...',ajaxMode:false,ajaxModeNumber:10};Spoiler.fn=$.Spoiler.prototype={init:function(el,options){this.$element=el!==false?$(el):false;this.loadOptions(options);this.build()},loadOptions:function(options){this.opts=$.extend({},$.extend(true,{},$.Spoiler.opts),this.$element.data(),options)},setCallback:function(type,e,data){var events=$._data(this.$element[0],'events');if(events&&typeof events[type]!='undefined'){var value=[];var len=events[type].length;for(var i=0;i<len;i++){var namespace=events[type][i].namespace;if(namespace=='tools.'+$.Spoiler.NAME||namespace==$.Spoiler.NAME+'.tools'){var callback=events[type][i].handler;value.push((typeof data=='undefined')?callback.call(this,e):callback.call(this,e,data))}}if(value.length==1)return value[0];else return value}return(typeof data=='undefined')?e:data},build:function(){this.$elementHide=this.$element.find(this.opts.elementHide);this.hideElement();this.$btn=this.$element.find('.'+this.opts.classButton);if(this.opts.ajaxMode==true){this.$btn.click($.proxy(this.onClickAjax,this))}else{this.$btn.click($.proxy(this.onClickSimple,this))}},hideElement:function(){var h=this.$element,i=this.opts.numberHide,btn=this.opts.classButton,text=this.opts.textButton;this.$elementHide.each(function(index,element){if(index>i-1){$(this).hide()}if(index==i){h.append('<div class="loadMore">'+'<a href="#" class="'+btn+'">'+text+'</a>'+'</div>')}})},onClickAjax:function(e){e.preventDefault();var i=this.$elementHide.length,n=this.opts.ajaxModeNumber,l=this.opts.elementHide,elv=this.$element.find(l+':visible'),s=elv.length+n,els=this.$element.find(l+':lt('+s+')');eli=this.$element.find(l+':lt('+i+')');if(s<i){if(this.opts.delay==true){this.$btn.text(this.opts.textLoading).addClass('active');setTimeout($.proxy(function(){els.show();this.$btn.text(this.opts.textButton).removeClass('active')},this),this.opts.delaySpeed)}else{els.show()}}else{if(this.opts.delay==true){this.$btn.text(this.opts.textLoading).addClass('active');setTimeout($.proxy(function(){eli.show();this.btnHide();this.$btn.text(this.opts.textButton).removeClass('active')},this),this.opts.delaySpeed)}else{eli.show();this.btnHide()}}this.setCallback('opened')},onClickSimple:function(e){e.preventDefault();if(this.opts.delay==true){this.$btn.text(this.opts.textLoading).addClass('active');setTimeout($.proxy(function(){this.elementShow();this.btnHide();this.$btn.text(this.opts.textButton).removeClass('active')},this),this.opts.delaySpeed)}else{this.elementShow();this.btnHide()}this.setCallback('opened')},elementShow:function(){this.$elementHide.show()},btnHide:function(){this.$btn.parent('.loadMore').hide()}};$(window).on('load.tools.spoiler',function(){$('[data-tools-spoiler="spoiler"]').spoiler()});Spoiler.prototype.init.prototype=Spoiler.prototype; 
})(jQuery);